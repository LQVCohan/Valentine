<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Valentine 14/02 üíò</title>
    <style>
    :root{
      --bg1:#fff0f6; --bg2:#ffe3ed; --card:#ffffffcc;
      --text:#1f2937; --muted:#6b7280;
      --pink:#ff4d8d; --pink2:#ff86b4; --pink3:#ffd1e4;
      --shadow: 0 18px 55px rgba(255, 77, 141, .22);
      --shadow2: 0 14px 40px rgba(31, 41, 55, .12);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 30% 0%, #ffd1e4 0%, transparent 60%),
        radial-gradient(900px 500px at 70% 15%, #ffe7f1 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* floating hearts background */
    .hearts{position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0;}
    .heart{position:absolute;width:14px;height:14px;transform:rotate(45deg);opacity:.22;animation: floatUp linear infinite;filter: blur(.15px);}
    .heart:before,.heart:after{content:"";position:absolute;width:100%;height:100%;background:var(--pink);border-radius:50%;}
    .heart{background:var(--pink)}
    .heart:before{left:-50%; top:0}
    .heart:after{left:0; top:-50%}
    @keyframes floatUp{from{transform: translateY(110vh) rotate(45deg);}to{transform: translateY(-20vh) rotate(45deg);}}

    .wrap{position:relative;z-index:1;max-width:980px;margin:0 auto;padding:24px 16px 52px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:999px;background:var(--card);box-shadow: var(--shadow2);backdrop-filter: blur(10px);}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px;}
    .badge{display:inline-flex;align-items:center;justify-content:center;width:34px;height:34px;border-radius:999px;background:linear-gradient(135deg, var(--pink), var(--pink2));box-shadow: 0 12px 26px rgba(255,77,141,.25);color:white;font-size:18px;}
    .tiny{color:var(--muted);font-weight:600;font-size:13px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    .btn{border:0;padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:750;transition:transform .08s ease, filter .12s ease;user-select:none;display:inline-flex;align-items:center;gap:8px;}
    .btn:hover{filter:brightness(1.02)}
    .btn:active{transform: translateY(1px) scale(.99)}
    .btn.primary{color:white;background:linear-gradient(135deg, var(--pink), var(--pink2));box-shadow: 0 14px 30px rgba(255,77,141,.26);}
    .btn.ghost{background:#fff;color:var(--text);box-shadow: 0 10px 26px rgba(31,41,55,.10);}

    .hero{margin-top:18px;border-radius: var(--radius);background: linear-gradient(135deg, #fff, #fff6fb);box-shadow: var(--shadow);overflow:hidden;display:grid;grid-template-columns: 1.1fr .9fr;gap:0;}
    @media (max-width: 820px){.hero{grid-template-columns:1fr}}
    .hero .left{padding:22px 22px 18px;}
    .kicker{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;background:#ffe1ef;border-radius:999px;font-weight:800;color:#9a1f52;font-size:13px;}
    h1{margin:12px 0 8px;font-size:clamp(28px,4vw,44px);line-height:1.05;letter-spacing:-.5px;}
    .sub{color:var(--muted);font-weight:600;font-size:15px;line-height:1.5;margin:0 0 14px;}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 0;}
    .chip{background:#fff;border:1px solid #ffd0e2;padding:7px 10px;border-radius:999px;font-weight:750;font-size:13px;color:#8a1747;}

    .hero .right{position:relative;min-height:280px;display:flex;align-items:center;justify-content:center;padding:18px;
      background:
        radial-gradient(260px 220px at 38% 35%, rgba(255,77,141,.18) 0%, transparent 60%),
        radial-gradient(220px 220px at 70% 70%, rgba(255,134,180,.20) 0%, transparent 62%),
        linear-gradient(135deg, #fff0f7, #fff);
    }
    /* Teddy cluster */
    .teddyCloud{position:relative;width:min(330px,78vw);height:260px;}
    .teddy{position:absolute;font-size:72px;filter: drop-shadow(0 18px 28px rgba(255,77,141,.22));}
    .teddy.t1{left:18%;top:18%;animation: bob 2.2s ease-in-out infinite;}
    .teddy.t2{left:48%;top:34%;font-size:78px;animation: bob 2.55s ease-in-out infinite;}
    .teddy.t3{left:34%;top:54%;font-size:64px;animation: bob 2.35s ease-in-out infinite;}
    .spark{position:absolute;font-size:18px;opacity:.9;animation: tw 1.8s ease-in-out infinite;}
    .spark.s1{left:10%;top:18%}
    .spark.s2{left:82%;top:30%}
    .spark.s3{left:75%;top:72%}
    .spark.s4{left:16%;top:78%}
    @keyframes bob{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-10px) rotate(2deg)}}
    @keyframes tw{0%,100%{transform:scale(1);opacity:.7}50%{transform:scale(1.25);opacity:1}}

    .heroNote{position:absolute;bottom:14px;left:14px;right:14px;background: rgba(255,255,255,.74);
      border: 1px solid rgba(255,77,141,.22);border-radius: 14px;padding:10px 12px;font-weight:700;color:#8a1747;
      box-shadow: 0 10px 26px rgba(31,41,55,.08);backdrop-filter: blur(10px);
    }

    .grid{margin-top:18px;display:grid;grid-template-columns:1fr 1fr;gap:14px;}
    @media (max-width: 820px){.grid{grid-template-columns:1fr}}
    .card{background: var(--card);border:1px solid rgba(255,77,141,.14);border-radius: var(--radius);padding:16px;box-shadow: var(--shadow2);backdrop-filter: blur(10px);}
    .card h2{margin:0 0 6px;font-size:18px;letter-spacing:-.2px;}
    .card p{margin:0;color:var(--muted);font-weight:600;line-height:1.5;font-size:14px}

    /* Gallery */
    .gallery{margin-top:10px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
    @media (max-width: 520px){.gallery{grid-template-columns:repeat(2,1fr)}}
    .shot{width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:16px;border:1px solid rgba(0,0,0,.06);box-shadow:0 12px 26px rgba(31,41,55,.10);cursor:pointer;transition:transform .12s ease, filter .12s ease;background:#fff;}
    .shot:hover{transform: translateY(-2px) scale(1.01);filter:saturate(1.03)}
    .shot:active{transform: translateY(0) scale(.995)}

    /* Candy jar */
    .jarWrap{display:flex;gap:14px;align-items:center;flex-wrap:wrap;margin-top:10px;}
    .jar{width:150px;height:190px;position:relative;}
    .jar svg{width:100%;height:100%}
    .candyLine{display:flex;flex-direction:column;gap:10px;flex:1;min-width:240px;}
    .candyOut{background:#fff;border:1px dashed rgba(255,77,141,.35);border-radius:16px;padding:12px 12px;font-weight:800;color:#8a1747;min-height:56px;display:flex;align-items:center;}
    .shake{animation: shake .4s ease-in-out 1;}
    @keyframes shake{0%,100%{transform:rotate(0deg)}25%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}75%{transform:rotate(-2deg)}}

    /* Mini game */
    .game{margin-top:10px;background:#fff;border:1px solid rgba(255,77,141,.18);border-radius:16px;padding:12px;}
    .gameTop{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:8px;}
    .score{font-weight:900;color:#8a1747;background:#ffe7f1;padding:8px 12px;border-radius:999px;}
    .rank{font-weight:900;color:#8a1747;background:#fff;border:1px solid rgba(255,77,141,.22);padding:8px 12px;border-radius:999px;}
    .progressWrap{margin-bottom:10px;background:#fff8fc;border:1px solid rgba(255,77,141,.16);border-radius:12px;padding:9px 10px;}
    .progressText{font-weight:800;color:#8a1747;font-size:13px;margin-bottom:8px;}
    .progressBar{height:10px;background:#ffe3ef;border-radius:999px;overflow:hidden;}
    .progressFill{height:100%;width:0%;background:linear-gradient(90deg,#ff4d8d,#ff86b4);transition:width .2s ease;}
    .playfield{position:relative;height:260px;border-radius:14px;overflow:hidden;background: radial-gradient(240px 120px at 30% 30%, #ffe5f0, #fff);border:1px solid rgba(0,0,0,.06);}
    .ground{position:absolute;left:0;right:0;bottom:0;height:44px;background: linear-gradient(180deg, rgba(255,77,141,.05), rgba(255,77,141,.12));border-top:1px solid rgba(255,77,141,.12);}
    .tapHeart{position:absolute;width:30px;height:30px;transform: rotate(45deg);cursor:pointer;animation: fall linear forwards;}
    .tapHeart:before,.tapHeart:after{content:"";position:absolute;width:30px;height:30px;background:var(--pink);border-radius:50%;}
    .tapHeart{background:var(--pink)}
    .tapHeart:before{left:-15px;top:0}
    .tapHeart:after{left:0;top:-15px}
    @keyframes fall{from{transform: translateY(-40px) rotate(45deg);opacity:.95}to{transform: translateY(290px) rotate(45deg);opacity:.10}}

    /* hit sparkle */
    .pop{position:absolute;pointer-events:none;transform: translate(-50%,-50%);animation: popOut .55s ease-out forwards;}
    @keyframes popOut{from{opacity:1;transform:translate(-50%,-50%) scale(.6)}to{opacity:0;transform:translate(-50%,-70%) scale(1.35)}}

    /* broken heart */
    .break{position:absolute;bottom:10px;transform: translateX(-50%);pointer-events:none;font-size:22px;filter: drop-shadow(0 10px 18px rgba(31,41,55,.18));animation: breakUp .65s ease-out forwards;}
    @keyframes breakUp{from{opacity:1;transform:translateX(-50%) translateY(0) scale(.9)}to{opacity:0;transform:translateX(-50%) translateY(-24px) scale(1.2)}}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;z-index:50;}
    .modal.show{display:block}
    .backdrop{position:absolute;inset:0;background: rgba(17,24,39,.48);backdrop-filter: blur(6px);}
    .dialog{position:relative;width:min(520px, calc(100vw - 26px));margin:min(11vh,90px) auto 0;background: rgba(255,255,255,.92);
      border:1px solid rgba(255,77,141,.18);border-radius:22px;box-shadow:0 35px 90px rgba(17,24,39,.25);padding:16px 16px 14px;animation: popd .14s ease-out;}
    @keyframes popd{from{transform:translateY(6px) scale(.99);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
    .dialogTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;}
    .dialog h3{margin:6px 0 6px;font-size:18px;letter-spacing:-.2px;}
    .close{border:0;width:38px;height:38px;border-radius:999px;cursor:pointer;font-size:18px;background:#fff;box-shadow:0 12px 26px rgba(31,41,55,.10);}
    .dialog .content{color:var(--muted);font-weight:650;line-height:1.55;font-size:14px;padding:8px 2px 10px;}
    .dialog .content ul{margin:8px 0 0 18px}
    .dialog .foot{display:flex;justify-content:flex-end;gap:10px;padding-top:6px;}

    /* Confetti */
    .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:60;display:none;}
    .confetti.show{display:block}
    .piece{position:absolute;width:10px;height:14px;opacity:.9;transform:rotate(10deg);animation: confettiFall linear forwards;}
    @keyframes confettiFall{from{transform: translateY(-20px) rotate(0deg);opacity:1}to{transform: translateY(110vh) rotate(740deg);opacity:.9}}

    /* Card + letter (password) */
    .valCardWrap{margin-top:14px}
    .valCard{background: rgba(255,255,255,.78);border:1px solid rgba(255,77,141,.18);border-radius:22px;box-shadow: var(--shadow2);backdrop-filter: blur(10px);overflow:hidden;}
    .valTop{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 14px;border-bottom:1px solid rgba(255,77,141,.10);}
    .seal{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;border-radius:999px;background:linear-gradient(135deg,var(--pink),var(--pink2));color:#fff;font-size:20px;box-shadow: 0 14px 30px rgba(255,77,141,.26);}
    .valBody{padding:14px 14px 16px}
    .pwRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .inp{flex:1;min-width:200px;border:1px solid rgba(255,77,141,.22);border-radius:14px;padding:12px 12px;font-weight:800;outline:none;}
    .hint{color:var(--muted);font-weight:650;font-size:13px;margin-top:8px}
    .envelope{position:relative;height:190px;border-radius:20px;overflow:hidden;
      background:
        radial-gradient(220px 100px at 50% -20%, rgba(255,255,255,.86), rgba(255,255,255,0) 65%),
        linear-gradient(145deg,#ffe8f2,#ffd8e9 55%,#ffd0e5);
      border:1px solid rgba(255,77,141,.24);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 16px 28px rgba(255,77,141,.14);
    }
    .envPaper{position:absolute;inset:0;background:
      linear-gradient(135deg, rgba(255,255,255,.35) 0%, rgba(255,255,255,.05) 32%, rgba(255,77,141,.07) 100%);
      pointer-events:none;}
    .envBody{position:absolute;inset:0;z-index:3;pointer-events:none;}
    .envBody:before,.envBody:after{content:"";position:absolute;bottom:0;width:52%;height:78%;
      background: linear-gradient(160deg,#ffe4f0,#ffd2e7 70%,#ffc6e0);
      border:1px solid rgba(255,77,141,.18);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.5);
    }
    .envBody:before{left:-3%;transform: skewY(19deg);transform-origin:bottom left;border-right:none;border-top-left-radius:18px;}
    .envBody:after{right:-3%;transform: skewY(-19deg);transform-origin:bottom right;border-left:none;border-top-right-radius:18px;}
    .envFlap{position:absolute;left:50%;top:0;z-index:6;transform: translateX(-50%);
      width:104%;height:70%;
      clip-path: polygon(50% 100%, 0 0, 100% 0);
      background:
        linear-gradient(180deg, #fff5fa 0%, #ffd9ea 48%, #ffc9e1 100%);
      border-bottom:1px solid rgba(255,77,141,.28);
      box-shadow: 0 6px 14px rgba(255,77,141,.18);
    }
    .envSealWax{position:absolute;left:50%;top:44%;z-index:7;transform:translate(-50%,-50%);
      width:54px;height:54px;border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ffbfd8 0%, #ff6aa2 45%, #d92f73 100%);
      border:2px solid rgba(255,255,255,.55);
      box-shadow: 0 8px 18px rgba(217,47,115,.45), inset 0 3px 8px rgba(255,255,255,.35);
      display:grid;place-items:center;color:#fff;font-size:22px;
      transition: transform .38s ease, opacity .35s ease;
    }
    .envSealWax:before{content:"‚ù§";transform: translateY(-1px);filter: drop-shadow(0 1px 1px rgba(0,0,0,.2));}
    .envelope.opened .envFlap{opacity:0;transform: translateX(-50%) translateY(-22px) scale(.94);}
    .envelope.opened .envSealWax{opacity:0;transform: translate(-50%,-50%) scale(.82);}
    .letter{position:absolute;left:14px;right:14px;bottom:14px;top:14px;border-radius:14px;background:#fff;border:1px solid rgba(0,0,0,.06);
      z-index:4;box-shadow:0 18px 40px rgba(31,41,55,.12);padding:14px;transform: translateY(118%);opacity:0;transition: transform .55s cubic-bezier(.2,.9,.2,1), opacity .4s ease;}
    .letter.open{transform: translateY(0);opacity:1}
    .letter h3{margin:0 0 8px;color:#8a1747}
    .letter p{margin:0;color:#6b7280;font-weight:650;line-height:1.6}
    .secret{margin-top:12px;padding:12px;border-radius:14px;background:#fff0f7;border:1px solid rgba(255,77,141,.16);display:none}
    .secret.show{display:block}
    .secretTitle{font-weight:900;color:#8a1747;margin-bottom:6px}
    .unlockReq{margin-top:10px;padding:11px;border-radius:14px;background:#fff;border:1px solid rgba(255,77,141,.18);}
    .unlockReq .title{font-weight:900;color:#8a1747;font-size:13px;margin-bottom:6px}
    .unlockReq ul{margin:0;padding-left:18px;color:#6b7280;font-weight:700;font-size:13px;line-height:1.6}
    .unlockReq .ok{color:#0f9d58}
  </style>
  </head>
  <body>
    <div class="hearts" id="bgHearts" aria-hidden="true"></div>
    <div class="confetti" id="confetti" aria-hidden="true"></div>

    <div class="wrap">
      <header>
        <div class="brand">
          <div class="badge">üíò</div>
          <div>
            <div>Valentine 14/02</div>
            <div class="tiny">G·ª≠i em y√™u ‚Äî t·ª´ <b>anh</b> ‚ù§Ô∏è</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn primary" id="btnSurprise">üéÅ M·ªü qu√†</button>
          <button class="btn ghost" id="btnMusic">üéµ B·∫≠t nh·∫°c</button>
        </div>
      </header>

      <section class="hero" aria-label="L·ªùi ch√∫c">
        <div class="left">
          <div class="kicker">‚ú® M·ªôt chi·∫øc web nh·ªè cho em</div>
          <h1>Ch√∫c em m·ªôt Valentine th·∫≠t ng·ªçt ng√†o üíû</h1>
          <p class="sub">
            Anh l√†m trang n√†y ƒë·ªÉ em v·ª´a xem ·∫£nh, v·ª´a ch∆°i v√†i tr√≤ ‚Äúcute ph√¥ mai
            que‚Äù,
            v√† quan tr·ªçng nh·∫•t l√†‚Ä¶ ƒë·ªÉ em bi·∫øt r·∫±ng <b>anh th∆∞∆°ng em r·∫•t
              nhi·ªÅu</b>.
          </p>
          <div class="actions" style="justify-content:flex-start">
            <button class="btn primary" id="btnLoveQuiz">üß† Quiz t√¨nh
              y√™u</button>
            <button class="btn ghost" id="btnCandy">üç¨ H≈© k·∫πo l·ªùi khen</button>
            <button class="btn ghost" id="btnGame">‚ù§Ô∏è B·∫Øt tim</button>
          </div>
          <div class="chips">
            <span class="chip">#em_l√†_ƒë·∫∑c_bi·ªát</span>
            <span class="chip">#anh_lu√¥n_·ªü_ƒë√¢y</span>
            <span class="chip">#h√¥m_nay_em_xinh</span>
          </div>
        </div>
        <div class="right">
          <div class="teddyCloud" aria-hidden="true">
            <div class="spark s1">‚ú®</div><div class="spark s2">‚ú®</div><div
              class="spark s3">‚ú®</div><div class="spark s4">‚ú®</div>
            <div class="teddy t1">üß∏</div>
            <div class="teddy t2">üß∏</div>
            <div class="teddy t3">üß∏</div>
          </div>
          <div class="heroNote">Tip: b·∫•m ‚ÄúM·ªü qu√†‚Äù ƒë·ªÉ nh·∫≠n b·∫•t ng·ªù nho nh·ªè
            üòö</div>
        </div>
      </section>

      <section class="grid">
        <div class="card" id="galleryCard">
          <h2>üì∏ Album ‚ÄúEm l√† y√™u th∆∞∆°ng‚Äù</h2>
          <p>·∫¢nh ƒë√£ ƒë∆∞·ª£c ch·ªânh l·∫°i ƒë·ªÉ m·∫∑t r√µ h∆°n v√† kh√¥ng d√≠nh UI. B·∫•m v√†o ·∫£nh
            ƒë·ªÉ ph√≥ng to nh√©.</p>
          <div class="gallery" id="gallery">
            <img class="shot" src="·∫¢nh/01.jpg" alt="·∫¢nh 1"
              data-full="·∫¢nh/01.jpg">
            <img class="shot" src="·∫¢nh/02.jpg" alt="·∫¢nh 2"
              data-full="·∫¢nh/02.jpg">
            <img class="shot" src="·∫¢nh/03.jpg" alt="·∫¢nh 3"
              data-full="·∫¢nh/03.jpg">
            <img class="shot" src="·∫¢nh/04.jpg" alt="·∫¢nh 4"
              data-full="·∫¢nh/04.jpg">
            <img class="shot" src="·∫¢nh/05.jpg" alt="·∫¢nh 5"
              data-full="·∫¢nh/05.jpg">
            <img class="shot" src="·∫¢nh/06.jpg" alt="·∫¢nh 6"
              data-full="·∫¢nh/06.jpg">
          </div>
        </div>

        <div class="card" id="candyCard">
          <h2>üç¨ H≈© k·∫πo l·ªùi khen</h2>
          <p>B·ªëc 1 vi√™n k·∫πo l√† nh·∫≠n 1 l·ªùi khen. L·∫Øc h≈© l√† k·∫πo ‚Äúr∆°i l·ªôp b·ªôp‚Äù
            trong tim anh üò≥</p>

          <div class="jarWrap">
            <div class="jar" id="jar">
              <svg viewBox="0 0 200 240" xmlns="http://www.w3.org/2000/svg"
                aria-label="H≈© k·∫πo">
                <defs>
                  <lineargradient id="gGlass" x1="0" x2="0" y1="0" y2="1">
                    <stop offset="0" stop-color="#ffffff" stop-opacity=".85" />
                    <stop offset=".55" stop-color="#ffffff"
                      stop-opacity=".35" />
                    <stop offset="1" stop-color="#ffffff" stop-opacity=".75" />
                  </lineargradient>
                  <lineargradient id="gLid" x1="0" x2="1">
                    <stop offset="0" stop-color="#ff4d8d" />
                    <stop offset="1" stop-color="#ff86b4" />
                  </lineargradient>
                  <lineargradient id="gShine" x1="0" x2="1">
                    <stop offset="0" stop-color="#fff" stop-opacity=".0" />
                    <stop offset=".35" stop-color="#fff" stop-opacity=".65" />
                    <stop offset="1" stop-color="#fff" stop-opacity=".0" />
                  </lineargradient>
                </defs>
                <rect x="50" y="18" rx="16" ry="16" width="100" height="34"
                  fill="url(#gLid)" />
                <rect x="58" y="8" rx="18" ry="18" width="84" height="24"
                  fill="url(#gLid)" opacity=".92" />
                <path
                  d="M55 58 C50 80, 45 110, 48 160 C51 206, 74 222, 100 224 C126 222, 149 206, 152 160 C155 110, 150 80, 145 58 Z"
                  fill="url(#gGlass)" stroke="rgba(255,77,141,.35)"
                  stroke-width="2" />
                <g opacity=".95">
                  <circle cx="78" cy="115" r="12" fill="#ff4d8d" />
                  <circle cx="110" cy="130" r="12" fill="#ff86b4" />
                  <circle cx="92" cy="150" r="12" fill="#ff4d8d" />
                  <circle cx="120" cy="155" r="12" fill="#ffd1e4" />
                  <circle cx="78" cy="170" r="12" fill="#ff86b4" />
                  <circle cx="108" cy="178" r="12" fill="#ff4d8d" />
                </g>
                <path d="M78 66 C64 98, 62 130, 64 164 C66 192, 76 208, 84 214"
                  fill="none" stroke="url(#gShine)" stroke-width="10"
                  stroke-linecap="round" opacity=".85" />
                <ellipse cx="100" cy="232" rx="60" ry="10"
                  fill="rgba(31,41,55,.10)" />
              </svg>
            </div>

            <div class="candyLine">
              <div class="candyOut" id="candyOut">B·∫•m ‚ÄúB·ªëc k·∫πo‚Äù ƒëi em üòö</div>
              <div class="actions" style="justify-content:flex-start">
                <button class="btn primary" id="btnPickCandy">üç¨ B·ªëc
                  k·∫πo</button>
                <button class="btn ghost" id="btnShakeJar">‚Üª L·∫Øc h≈©</button>
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="quizCard">
          <h2>üß† Quiz t√¨nh y√™u</h2>
          <p>Tr·∫£ l·ªùi nhanh cho vui. Cu·ªëi quiz c√≥ ‚Äúph·∫ßn th∆∞·ªüng‚Äù nha!</p>
          <div class="actions"
            style="justify-content:flex-start; margin-top:10px">
            <button class="btn primary" id="btnStartQuiz">B·∫Øt ƒë·∫ßu</button>
          </div>
        </div>

        <div class="card" id="gameCard">
          <h2>‚ù§Ô∏è Mini game: B·∫Øt tim</h2>
          <p>
            B·∫•m tim r∆°i xu·ªëng ƒë·ªÉ ghi ƒëi·ªÉm. C√≥ hi·ªáu ·ª©ng ‚Äúb·∫Øt tr√∫ng‚Äù v√† ‚Äútim v·ª°‚Äù
            n·∫øu b·ªè l·ª°.
            <br />M·ªëc 30 tim s·∫Ω m·ªü <b>b√≠ m·∫≠t</b> trong t·∫•m thi·ªáp üíå
          </p>

          <div class="game">
            <div class="progressWrap">
              <div class="progressText" id="gameProgressText">Ti·∫øn ƒë·ªô: s·∫µn s√†ng
                b·∫Øt tim üíó</div>
              <div class="progressBar" aria-hidden="true">
                <div class="progressFill" id="gameProgressFill"></div>
              </div>
            </div>
            <div class="gameTop">
              <div class="score" id="score">ƒêi·ªÉm: 0</div>
              <div class="rank" id="rank">Danh hi·ªáu: Ch∆∞a ch∆°i</div>
              <div class="actions" style="justify-content:flex-start">
                <button class="btn primary" id="btnPlay">Ch∆°i</button>
                <button class="btn ghost" id="btnStop">D·ª´ng</button>
              </div>
            </div>
            <div class="playfield" id="playfield" aria-label="Khu v·ª±c ch∆°i">
              <div class="ground"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="valCardWrap" id="letterCard">
        <div class="valCard">
          <div class="valTop">
            <div style="display:flex;gap:10px;align-items:center">
              <div class="seal">üíå</div>
              <div>
                <div style="font-weight:900;color:#8a1747">Thi·ªáp b√≠ m·∫≠t c·ªßa
                  anh</div>
                <div class="tiny">Nh·∫≠p ƒë√∫ng m·∫≠t kh·∫©u th√¨ l√° th∆∞ s·∫Ω ‚Äútr∆∞·ª£t‚Äù ra
                  ü•∫</div>
              </div>
            </div>
            <button class="btn ghost" id="btnScrollGame">üéÆ T·ªõi mini
              game</button>
          </div>

          <div class="valBody">
            <div class="envelope" aria-label="Thi·ªáp v√† phong th∆∞">
              <div class="envPaper"></div>
              <div class="envBody"></div>
              <div class="envFlap"></div>
              <div class="envSealWax" aria-hidden="true"></div>
              <div class="letter" id="letter">
                <h3>L√° th∆∞ d√†nh cho em üíó</h3>
                <p id="letterMain">
                  Em √†, n·∫øu em ƒëang ƒë·ªçc t·ªõi ƒë√¢y th√¨ ch·∫Øc l√†‚Ä¶ em ƒë√£ m·ªü ƒë√∫ng chi·∫øc
                  thi·ªáp anh g·ª≠i r·ªìi.
                  Anh kh√¥ng gi·ªèi n√≥i ƒëi·ªÅu to t√°t, nh∆∞ng anh mu·ªën em bi·∫øt: <b>anh
                    tr√¢n tr·ªçng em</b> v√† lu√¥n mu·ªën em vui.
                </p>

                <div class="secret" id="secretBox">
                  <div class="secretTitle">üîê B√≠ m·∫≠t (m·ªü khi ƒë·∫°t 30 tim)</div>
                  <div style="color:#6b7280;font-weight:700;line-height:1.6">
                    <b>[B√ç M·∫¨T C·ª¶A NG∆Ø·ªúI CON TRAI]</b><br />
                    (Anh t·ª± ch·ªânh ƒëo·∫°n n√†y sau nh√© üòö)
                  </div>
                </div>
              </div>
            </div>

            <div class="pwRow">
              <input class="inp" id="pw" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..."
                autocomplete="off" />
              <button class="btn primary" id="btnOpenLetter">M·ªü thi·ªáp</button>
            </div>
            <div class="unlockReq" id="unlockReq">
              <div class="title">ƒêi·ªÅu ki·ªán m·ªü th∆∞ cu·ªëi:</div>
              <ul>
                <li id="reqPw">‚ùå Nh·∫≠p ƒë√∫ng m·∫≠t kh·∫©u</li>
                <li id="reqQuiz">‚ùå Ho√†n th√†nh quiz t·ªëi thi·ªÉu 4/5</li>
                <li id="reqCandy">‚ùå L·∫Øc h≈© t·ªõi khi r∆°i ƒë∆∞·ª£c ch√¨a kh√≥a</li>
                <li id="reqGame">‚ùå B·∫Øt tim ƒë·∫°t m·ªëc cu·ªëi (30/30)</li>
              </ul>
            </div>
            <div class="hint">G·ª£i √Ω: m·∫≠t kh·∫©u l√† th·ª© m√† ‚Äúanh bi·∫øt em s·∫Ω nh·ªõ‚Äù
              üòå</div>
          </div>
        </div>
      </section>
    </div>

    <div class="modal" id="modal" role="dialog" aria-modal="true"
      aria-labelledby="modalTitle">
      <div class="backdrop" id="modalBackdrop"></div>
      <div class="dialog" role="document">
        <div class="dialogTop">
          <h3 id="modalTitle">Modal</h3>
          <button class="close" id="modalClose" aria-label="ƒê√≥ng">‚úï</button>
        </div>
        <div class="content" id="modalBody"></div>
        <div class="foot">
          <button class="btn primary" id="modalOk">OK</button>
        </div>
      </div>
    </div>

    <audio id="bgm" preload="auto" loop></audio>

    <script>
    const CARD_PASSWORD = "CohanXGinn";
    const PROGRESS_STORAGE_KEY = "valentine_progress_v2";

    (function spawnBgHearts(){
      const wrap = document.getElementById('bgHearts');
      const n = 18;
      for(let i=0;i<n;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        const left = Math.random()*100;
        const dur = 10 + Math.random()*16;
        const delay = Math.random()*-20;
        const size = 10 + Math.random()*14;
        h.style.left = left + 'vw';
        h.style.animationDuration = dur + 's';
        h.style.animationDelay = delay + 's';
        h.style.width = size + 'px';
        h.style.height = size + 'px';
        wrap.appendChild(h);
      }
    })();

    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody  = document.getElementById('modalBody');
    const modalOk    = document.getElementById('modalOk');
    const modalClose = document.getElementById('modalClose');
    const modalBackdrop = document.getElementById('modalBackdrop');

    function showModal(title, html){
      modalTitle.textContent = title || "Th√¥ng b√°o";
      modalBody.innerHTML = html || "";
      modal.classList.add('show');
      setTimeout(()=>modalOk.focus(), 10);
    }
    function hideModal(){ modal.classList.remove('show'); }
    modalOk.addEventListener('click', hideModal);
    modalClose.addEventListener('click', hideModal);
    modalBackdrop.addEventListener('click', hideModal);
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('show')) hideModal(); });

    document.getElementById('btnSurprise').addEventListener('click', ()=>{
      showModal("üéÅ B·∫•t ng·ªù n√®!", `
        <div style="font-weight:800;color:#8a1747;margin-bottom:6px">B√© iu, em ch√≠nh th·ª©c nh·∫≠n ƒë∆∞·ª£c:</div>
        <ul>
          <li>1 c√°i √¥m th·∫≠t ch·∫∑t</li>
          <li>1 b·ªØa ƒÉn ngon</li>
          <li>V√† 1 ng∆∞·ªùi th∆∞∆°ng em r·∫•t nhi·ªÅu ü•∞</li>
        </ul>
        <div style="margin-top:10px;color:#6b7280;font-weight:650">G·ª£i √Ω: ch∆°i ‚ÄúB·∫Øt tim‚Äù ƒë·ªÉ m·ªü b√≠ m·∫≠t trong thi·ªáp nha!</div>
      `);
      burstConfetti();
    });

    document.getElementById('gallery').addEventListener('click', (e)=>{
      const img = e.target.closest('img');
      if(!img) return;
      const src = img.getAttribute('data-full');
      showModal("üì∏ ·∫¢nh c·ªßa em", `<img src="${src}" alt="·∫¢nh" style="width:100%;border-radius:16px;border:1px solid rgba(0,0,0,.06)" />`);
    });

    const compliments = [
      "H√¥m nay em xinh qu√° tr·ªùi lu√¥n üòç",
      "N·ª• c∆∞·ªùi c·ªßa em l√†m anh m·ªÅm tim üò≥",
      "·ªû c·∫°nh em, m·ªçi th·ª© ƒë·ªÅu nh·∫π nh√†ng h∆°n üíó",
      "Em ƒë√°ng y√™u ki·ªÉu‚Ä¶ kh√¥ng ai ƒë·ª° n·ªïi ü•∫",
      "Em l√† ƒëi·ªÅu may m·∫Øn nh·∫•t c·ªßa anh üçÄ",
      "Gi·ªçng em nghe l√† th·∫•y b√¨nh y√™n r·ªìi üòö",
      "Em v·ª´a ƒë·∫πp v·ª´a gi·ªèi, ai m√† kh√¥ng m√™!",
      "Anh th∆∞∆°ng em nhi·ªÅu h∆°n c·∫£ h√¥m qua (m√† h√¥m qua ƒë√£ nhi·ªÅu l·∫Øm r·ªìi) üíû",
      "Em l√† ‚Äúnh√†‚Äù c·ªßa anh, d√π anh ·ªü ƒë√¢u üè°",
      "Em ∆°i, em l√†m anh nh·ªõ em qu√° ü•∞",
    ];
    const candyOut = document.getElementById('candyOut');
    const jar = document.getElementById('jar');
    let hasCandyKey = false;
    let shakeCount = 0;

    let quizPassed = false;
    let gameGoalReached = false;
    let bestHeartScore = 0;
    let letterOpened = false;

    const reqPw = document.getElementById('reqPw');
    const reqQuiz = document.getElementById('reqQuiz');
    const reqCandy = document.getElementById('reqCandy');
    const reqGame = document.getElementById('reqGame');

    function markReq(el, ok, text){
      el.textContent = `${ok ? '‚úÖ' : '‚ùå'} ${text}`;
      el.classList.toggle('ok', ok);
    }

    function refreshUnlockChecklist(isPwOk = false){
      markReq(reqPw, isPwOk, 'Nh·∫≠p ƒë√∫ng m·∫≠t kh·∫©u');
      markReq(reqQuiz, quizPassed, 'Ho√†n th√†nh quiz t·ªëi thi·ªÉu 4/5');
      markReq(reqCandy, hasCandyKey, 'L·∫Øc h≈© t·ªõi khi r∆°i ƒë∆∞·ª£c ch√¨a kh√≥a');
      markReq(reqGame, gameGoalReached, 'B·∫Øt tim ƒë·∫°t m·ªëc cu·ªëi (30/30)');
    }

    function saveProgress(){
      const payload = {
        hasCandyKey,
        shakeCount,
        quizPassed,
        gameGoalReached,
        bestHeartScore,
        letterOpened,
      };
      localStorage.setItem(PROGRESS_STORAGE_KEY, JSON.stringify(payload));
    }

    function loadProgress(){
      const raw = localStorage.getItem(PROGRESS_STORAGE_KEY);
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        hasCandyKey = Boolean(data.hasCandyKey);
        shakeCount = Number.isFinite(data.shakeCount) ? Math.max(0, data.shakeCount) : 0;
        quizPassed = Boolean(data.quizPassed);
        gameGoalReached = Boolean(data.gameGoalReached);
        bestHeartScore = Number.isFinite(data.bestHeartScore) ? Math.max(0, data.bestHeartScore) : 0;
        letterOpened = Boolean(data.letterOpened);
      }catch{
        localStorage.removeItem(PROGRESS_STORAGE_KEY);
      }
    }

    refreshUnlockChecklist(false);

    document.getElementById('btnPickCandy').addEventListener('click', ()=>{
      const msg = compliments[Math.floor(Math.random()*compliments.length)];
      candyOut.textContent = msg;
      burstConfetti(18);
    });
    document.getElementById('btnShakeJar').addEventListener('click', ()=>{
      jar.classList.remove('shake'); void jar.offsetWidth; jar.classList.add('shake');
      shakeCount++;
      const hitKey = !hasCandyKey && (shakeCount >= 5 && Math.random() < 0.35);
      if(hitKey){
        hasCandyKey = true;
        candyOut.textContent = "üîë Ting! Em ƒë√£ l·∫Øc r∆°i ƒë∆∞·ª£c ch√¨a kh√≥a r·ªìi n√®!";
        burstConfetti(22);
      } else {
        candyOut.textContent = "L·∫Øc l·∫Øc‚Ä¶ k·∫πo r∆°i ra: " + compliments[Math.floor(Math.random()*compliments.length)];
      }
      refreshUnlockChecklist(pw.value === CARD_PASSWORD);
      saveProgress();
    });
    document.getElementById('btnCandy').addEventListener('click', ()=>{
      document.getElementById('candyCard').scrollIntoView({behavior:'smooth', block:'start'});
      setTimeout(()=>showModal("üç¨ H≈© k·∫πo l·ªùi khen", "K√©o xu·ªëng m·ªôt ch√∫t l√† th·∫•y h≈© k·∫πo nha em üòö"), 450);
    });

    const quiz = [
      { q: "Khi em bu·ªìn, anh n√™n l√†m g√¨ tr∆∞·ªõc?", a: ["√îm em th·∫≠t ch·∫∑t", "Im l·∫∑ng cho em t·ª± x·ª≠", "Ch∆°i game ti·∫øp"], correct: 0 },
      { q: "M√≥n ‚Äúqu√†‚Äù anh mu·ªën t·∫∑ng em nh·∫•t l√†‚Ä¶", a: ["Th·ªùi gian + s·ª± quan t√¢m", "M·ªôt c√°i h·ª©a th·∫≠t ch·∫Øc", "C·∫£ hai (t·∫•t nhi√™n!)"], correct: 2 },
      { q: "Em th√≠ch ki·ªÉu h·∫πn h√≤ n√†o?", a: ["ƒêi ƒÉn ngon", "ƒêi d·∫°o + n√≥i chuy·ªán", "·ªû nh√† xem phim"], correct: 1 },
      { q: "Ai l√† ng∆∞·ªùi ƒë√°ng y√™u nh·∫•t v≈© tr·ª•?", a: ["Em", "Em", "Em"], correct: 0 },
      { q: "Ch·ªçn c√¢u ƒë√∫ng:", a: ["Anh th∆∞∆°ng em", "Anh th∆∞∆°ng em r·∫•t nhi·ªÅu", "Anh th∆∞∆°ng em v√¥ h·∫°n"], correct: 2 },
    ];

    function runQuiz(){
      let idx = 0, qscore = 0;
      function render(){
        const item = quiz[idx];
        const buttons = item.a.map((txt,i)=>`
          <button class="btn ${i===0?'primary':'ghost'}" data-i="${i}" style="width:100%; justify-content:center">${txt}</button>
        `).join('<div style="height:10px"></div>');
        showModal(`üß† Quiz (${idx+1}/${quiz.length})`, `
          <div style="font-weight:900;color:#8a1747">${item.q}</div>
          <div style="height:12px"></div>
          <div style="display:grid; gap:10px">${buttons}</div>
          <div style="margin-top:10px;font-weight:700;color:#6b7280">ƒêi·ªÉm hi·ªán t·∫°i: ${qscore}</div>
        `);
        [...modalBody.querySelectorAll('button[data-i]')].forEach(b=>{
          b.addEventListener('click', ()=>{
            const chosen = Number(b.getAttribute('data-i'));
            if(chosen === item.correct) qscore++;
            idx++;
            if(idx >= quiz.length) finish();
            else render();
          });
        });
      }
      function finish(){
        quizPassed = qscore >= 4;
        refreshUnlockChecklist(pw.value === CARD_PASSWORD);
        saveProgress();
        burstConfetti();
        showModal("üéâ K·∫øt qu·∫£!", `
          <div style="font-weight:900;color:#8a1747">Em ƒë·∫°t ${qscore}/${quiz.length} ƒëi·ªÉm!</div>
          <div style="margin-top:8px;font-weight:800;color:${quizPassed ? '#0f9d58' : '#b42318'}">
            ${quizPassed ? '‚úÖ ƒê√£ ƒë·∫°t ƒëi·ªÅu ki·ªán quiz (>=4/5)' : '‚ùå Ch∆∞a ƒë·∫°t ƒëi·ªÅu ki·ªán quiz (c·∫ßn >=4/5)'}
          </div>
          <div style="margin-top:8px"><b>Ph·∫ßn th∆∞·ªüng:</b> 1 c√°i √¥m + 1 l·ªùi nh·∫Øn:</div>
          <div style="margin-top:10px;background:#fff;border:1px solid rgba(255,77,141,.2);border-radius:16px;padding:12px;font-weight:800;color:#8a1747">
            ‚ÄúEm l√† ƒëi·ªÅu anh tr√¢n tr·ªçng nh·∫•t. C·∫£m ∆°n em v√¨ ƒë√£ ·ªü ƒë√¢y.‚Äù üíó
          </div>
        `);
      }
      render();
    }
    document.getElementById('btnStartQuiz').addEventListener('click', runQuiz);
    document.getElementById('btnLoveQuiz').addEventListener('click', ()=>{
      document.getElementById('quizCard').scrollIntoView({behavior:'smooth', block:'start'});
      setTimeout(runQuiz, 450);
    });

    const playfield = document.getElementById('playfield');
    const scoreEl = document.getElementById('score');
    const rankEl = document.getElementById('rank');
    const gameProgressText = document.getElementById('gameProgressText');
    const gameProgressFill = document.getElementById('gameProgressFill');
    let playing = false;
    let score = 0;
    let spawner = null;

    let secretUnlocked = false;
    const secretBox = document.getElementById('secretBox');
    const PROGRESS_TARGET = 30;

    function updateGameProgress(s, {persistAchievement = true} = {}){
      if(persistAchievement && s >= PROGRESS_TARGET) gameGoalReached = true;
      const visual = gameGoalReached ? PROGRESS_TARGET : s;
      const pct = Math.min(100, (visual / PROGRESS_TARGET) * 100);
      gameProgressFill.style.width = pct + '%';
      refreshUnlockChecklist(pw.value === CARD_PASSWORD);
      gameProgressText.textContent = gameGoalReached
        ? 'Ho√†n th√†nh! Em ƒë√£ ƒë·∫°t 30/30 tim v√† m·ªü b√≠ m·∫≠t üíå'
        : `Ti·∫øn ƒë·ªô m·ªü b√≠ m·∫≠t: ${s}/${PROGRESS_TARGET} tim`;
    }

    function setRank(s){
      const ranks = [
        [0,  "Ch∆∞a ch∆°i"],
        [1,  "T√¢n binh ƒë√°ng y√™u üê£"],
        [10, "Ng∆∞·ªùi th∆∞∆°ng chuy√™n c·∫ßn üíó"],
        [20, "Chuy√™n gia b·∫Øt tim üòé"],
        [30, "Ch·ªß nh√¢n tr√°i tim anh üèÜ"],
        [50, "Huy·ªÅn tho·∫°i t√¨nh y√™u ‚ú®"],
      ];
      let r = ranks[0][1];
      for(const [t,name] of ranks) if(s >= t) r = name;
      rankEl.textContent = "Danh hi·ªáu: " + r;
    }

    function milestoneCheck(s){
      if(s === 30){
        secretUnlocked = true;
        secretBox.classList.add('show');
        document.getElementById('letterCard').scrollIntoView({behavior:'smooth', block:'start'});
        burstConfetti(36);
        saveProgress();
        // TODO: Anh t·ª± ch·ªânh n·ªôi dung b√≠ m·∫≠t ·ªü secretBox
      }
    }

    function popAt(x,y,emoji){
      const p = document.createElement('div');
      p.className = 'pop';
      p.style.left = x + 'px';
      p.style.top  = y + 'px';
      p.innerHTML = `<span style="font-size:18px">${emoji}</span><span style="margin-left:6px;font-weight:900;color:#8a1747">+1</span>`;
      playfield.appendChild(p);
      p.addEventListener('animationend', ()=>p.remove());
    }

    function breakAt(x){
      const b = document.createElement('div');
      b.className = 'break';
      b.style.left = x + 'px';
      b.textContent = "üíî";
      playfield.appendChild(b);
      b.addEventListener('animationend', ()=>b.remove());
    }

    function spawnTapHeart(){
      const h = document.createElement('div');
      h.className = 'tapHeart';
      const x = Math.random()*(playfield.clientWidth - 30) + 15;
      const dur = 1.25 + Math.random()*1.55;
      h.style.left = (x-15) + 'px';
      h.style.animationDuration = dur + 's';

      let hit = false;

      h.addEventListener('click', (ev)=>{
        hit = true;
        score++;
        bestHeartScore = Math.max(bestHeartScore, score);
        scoreEl.textContent = "ƒêi·ªÉm: " + score;
        updateGameProgress(score);
        setRank(score);
        popAt(x, ev.offsetY, "‚ú®");
        burstConfetti(8);
        milestoneCheck(score);
        saveProgress();
        h.remove();
      });

      h.addEventListener('animationend', ()=>{
        if(!hit) breakAt(x);
        h.remove();
      });

      playfield.appendChild(h);
    }

    function startGame(){
      if(playing) return;
      playing = true;
      score = 0;
      scoreEl.textContent = "ƒêi·ªÉm: 0";
      updateGameProgress(0, {persistAchievement:false});
      setRank(0);
      spawner = setInterval(spawnTapHeart, 420);
      spawnTapHeart();
      gameProgressText.textContent = "Game ƒë√£ b·∫Øt ƒë·∫ßu! B·∫Øt tim li√™n t·ª•c nha em üòÜ";
    }

    function stopGame(){
      playing = false;
      if(spawner) clearInterval(spawner);
      spawner = null;
      [...playfield.querySelectorAll('.tapHeart')].forEach(n=>n.remove());
      gameProgressText.textContent = `ƒê√£ d·ª´ng game. Th√†nh t√≠ch cu·ªëi: ${score} tim üíó`;
      burstConfetti(22);
      saveProgress();
    }

    document.getElementById('btnPlay').addEventListener('click', startGame);
    document.getElementById('btnStop').addEventListener('click', stopGame);
    document.getElementById('btnGame').addEventListener('click', ()=>{
      document.getElementById('gameCard').scrollIntoView({behavior:'smooth', block:'start'});
      setTimeout(startGame, 450);
    });
    document.getElementById('btnScrollGame').addEventListener('click', ()=>{
      document.getElementById('gameCard').scrollIntoView({behavior:'smooth', block:'start'});
    });

    const pw = document.getElementById('pw');
    const letter = document.getElementById('letter');
    const envelope = document.querySelector('.envelope');
    document.getElementById('btnOpenLetter').addEventListener('click', ()=>{
      const isPwOk = pw.value === CARD_PASSWORD;
      refreshUnlockChecklist(isPwOk);
      if(isPwOk && quizPassed && hasCandyKey && gameGoalReached){
        letter.classList.add('open');
        envelope.classList.add('opened');
        letterOpened = true;
        saveProgress();
        burstConfetti(20);
        showModal("üíå M·ªü thi·ªáp th√†nh c√¥ng", "Anh bi·∫øt em l√†m ƒë∆∞·ª£c m√† üòö");
      } else {
        showModal("üîí Ch∆∞a m·ªü ƒë∆∞·ª£c th∆∞", "C·∫ßn nh·∫≠p ƒë√∫ng m·∫≠t kh·∫©u v√† ho√†n th√†nh ƒë·ªß 3 minigame ƒë·ªÉ m·ªü th∆∞ cu·ªëi nha em üíó");
      }
    });
    pw.addEventListener('input', ()=>refreshUnlockChecklist(pw.value === CARD_PASSWORD));
    pw.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') document.getElementById('btnOpenLetter').click(); });

    function applyProgressToUi(){
      if(hasCandyKey) candyOut.textContent = "üîë Em ƒë√£ c√≥ ch√¨a kh√≥a r·ªìi, m·ªü th∆∞ th√¥i n√†o!";
      scoreEl.textContent = "ƒêi·ªÉm: " + bestHeartScore;
      setRank(bestHeartScore);
      updateGameProgress(bestHeartScore, {persistAchievement:false});
      if(gameGoalReached){
        secretUnlocked = true;
        secretBox.classList.add('show');
      }
      if(letterOpened){
        letter.classList.add('open');
        envelope.classList.add('opened');
      }
      refreshUnlockChecklist(pw.value === CARD_PASSWORD);
    }

    function resetProgress(){
      playing = false;
      if(spawner) clearInterval(spawner);
      spawner = null;
      [...playfield.querySelectorAll('.tapHeart')].forEach(n=>n.remove());
      hasCandyKey = false;
      shakeCount = 0;
      quizPassed = false;
      gameGoalReached = false;
      bestHeartScore = 0;
      letterOpened = false;
      secretUnlocked = false;
      score = 0;
      candyOut.textContent = "B·∫•m ‚ÄúB·ªëc k·∫πo‚Äù ƒëi em üòö";
      gameProgressFill.style.width = '0%';
      gameProgressText.textContent = 'Ti·∫øn ƒë·ªô: s·∫µn s√†ng b·∫Øt tim üíó';
      scoreEl.textContent = 'ƒêi·ªÉm: 0';
      setRank(0);
      secretBox.classList.remove('show');
      letter.classList.remove('open');
      envelope.classList.remove('opened');
      pw.value = '';
      localStorage.removeItem(PROGRESS_STORAGE_KEY);
      refreshUnlockChecklist(false);
    }

    document.getElementById('btnReset').addEventListener('click', ()=>{
      showModal('‚ôªÔ∏è Reset th√†nh t√≠ch', 'ƒê√£ reset to√†n b·ªô ti·∫øn ƒë·ªô l∆∞u tr√™n m√°y n√†y. B·∫Øt ƒë·∫ßu l·∫°i t·ª´ ƒë·∫ßu nha em üíó');
      resetProgress();
    });

    loadProgress();
    applyProgressToUi();

    const bgm = document.getElementById('bgm');
    let musicOn = false;
    const btnMusic = document.getElementById('btnMusic');
    btnMusic.addEventListener('click', async ()=>{
      if(!bgm.src){
        showModal("üéµ Nh·∫°c n·ªÅn", `
          <div>Trang hi·ªán ch∆∞a c√≥ file nh·∫°c.</div>
          <div style="margin-top:8px">
            N·∫øu mu·ªën c√≥ nh·∫°c: ch√©p <b>music.mp3</b> c√πng th∆∞ m·ª•c v·ªõi <b>valentine.html</b> v√† th√™m d√≤ng:
            <div style="margin-top:8px;background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:10px;font-weight:800;color:#8a1747">
              bgm.src = "music.mp3";
            </div>
          </div>
        `);
        return;
      }
      try{
        if(!musicOn){ await bgm.play(); musicOn = true; btnMusic.textContent = "‚è∏Ô∏è T·∫Øt nh·∫°c"; }
        else{ bgm.pause(); musicOn = false; btnMusic.textContent = "üéµ B·∫≠t nh·∫°c"; }
      }catch{ showModal("‚ö†Ô∏è Kh√¥ng b·∫≠t ƒë∆∞·ª£c nh·∫°c", "Tr√¨nh duy·ªát c√≥ th·ªÉ ch·∫∑n autoplay. Em b·∫•m l·∫°i l·∫ßn n·ªØa nha üòö"); }
    });

    function burstConfetti(count=26){
      const layer = document.getElementById('confetti');
      layer.innerHTML = "";
      layer.classList.add('show');

      const colors = ["#ff4d8d","#ff86b4","#ffd1e4","#ffe1ef","#ffb3d2"];
      const W = window.innerWidth;
      const H = window.innerHeight;

      for(let i=0;i<count;i++){
        const p = document.createElement('div');
        p.className = 'piece';
        p.style.left = Math.random()*W + "px";
        p.style.top = (-20 - Math.random()*H*0.2) + "px";
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.animationDuration = (2.2 + Math.random()*1.8) + "s";
        p.style.animationDelay = (Math.random()*0.15) + "s";
        p.style.borderRadius = (2 + Math.random()*4) + "px";
        layer.appendChild(p);
        p.addEventListener('animationend', ()=> p.remove());
      }
      setTimeout(()=> layer.classList.remove('show'), 2800);
    }
  </script>
  </body>
</html>
