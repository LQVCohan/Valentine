<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine 14/02 üíò</title>
  <style>
    :root{
      color-scheme: light;
      --bg1:#fff0f6;
      --bg2:#ffe3ed;
      --card:#ffffffd9;
      --text:#1f2937;
      --muted:#6b7280;
      --pink:#ff4d8d;
      --pink2:#ff86b4;
      --shadow: 0 18px 55px rgba(255, 77, 141, .22);
      --radius: 18px;
    }
    :root[data-theme="dark"]{
      color-scheme: dark;
      --bg1:#17131a;
      --bg2:#271824;
      --card:#191a21d9;
      --text:#ffe6f0;
      --muted:#d3b6c3;
      --pink:#ff66a1;
      --pink2:#ffa2c7;
      --shadow: 0 18px 55px rgba(255, 102, 161, .2);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 30% 0%, #ffd1e4 0%, transparent 60%),
        radial-gradient(900px 500px at 70% 15%, #ffe7f1 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }
    .wrap{max-width:1020px;margin:0 auto;padding:24px 16px 48px;position:relative;z-index:2}
    .hearts{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:0}
    .heart{position:absolute;width:14px;height:14px;transform:rotate(45deg);opacity:.22;animation:floatUp linear infinite;background:var(--pink)}
    .heart::before,.heart::after{content:"";position:absolute;width:14px;height:14px;background:var(--pink);border-radius:50%}
    .heart::before{left:-7px}.heart::after{top:-7px}
    @keyframes floatUp{from{transform:translateY(110vh) rotate(45deg)}to{transform:translateY(-20vh) rotate(45deg)}}

    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:999px;background:var(--card);box-shadow:var(--shadow);backdrop-filter: blur(10px)}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .badge{display:grid;place-items:center;width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--pink2));color:#fff}
    .tiny{color:var(--muted);font-size:13px;font-weight:600}
    .actions{display:flex;flex-wrap:wrap;gap:10px}
    .btn{border:0;padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:750;transition:.15s;display:inline-flex;align-items:center;gap:8px}
    .btn:hover{filter:brightness(1.03)}
    .btn:active{transform:translateY(1px) scale(.99)}
    .btn:focus-visible{outline:2px solid color-mix(in srgb, var(--pink), white 20%);outline-offset:2px}
    .btn.primary{color:#fff;background:linear-gradient(135deg,var(--pink),var(--pink2));box-shadow:0 14px 30px rgba(255,77,141,.25)}
    .btn.ghost{color:var(--text);background:color-mix(in srgb, var(--card), #fff 14%)}
    .btn.sm{padding:8px 12px;font-size:13px}

    .hero{margin-top:18px;border-radius:var(--radius);background:linear-gradient(135deg,#fff,#fff6fb);box-shadow:var(--shadow);display:grid;grid-template-columns:1.1fr .9fr;overflow:hidden}
    @media (max-width:840px){.hero{grid-template-columns:1fr}}
    .left{padding:22px}
    .kicker{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;background:#ffe1ef;border-radius:999px;font-size:13px;font-weight:800;color:#9a1f52}
    h1{margin:12px 0 8px;font-size:clamp(28px,4vw,44px);line-height:1.05}
    .sub{margin:0;color:var(--muted);font-weight:600;line-height:1.5}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    .chip{padding:7px 10px;border-radius:999px;background:#fff;border:1px solid #ffd0e2;color:#8a1747;font-weight:700;font-size:13px}
    .right{position:relative;display:grid;place-items:center;min-height:280px;padding:18px;background:radial-gradient(240px 240px at 40% 35%, rgba(255,77,141,.20) 0%, transparent 60%),linear-gradient(135deg,#fff0f7,#fff)}
    .bigBear{font-size:min(180px,36vw);filter:drop-shadow(0 18px 30px rgba(255,77,141,.24));animation:pulse 1.7s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    .heroNote{position:absolute;left:14px;right:14px;bottom:14px;padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.82);border:1px solid rgba(255,77,141,.2);font-weight:700;color:#8a1747}

    .grid{display:grid;gap:14px;grid-template-columns:1fr 1fr;margin-top:18px}
    @media (max-width:840px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid rgba(255,77,141,.16);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);backdrop-filter:blur(10px)}
    .card h2{margin:0 0 6px;font-size:19px}
    .card p{margin:0;color:var(--muted);font-weight:600;line-height:1.5}

    .teddyWall{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    @media (max-width:520px){.teddyWall{grid-template-columns:repeat(2,1fr)}}
    .teddyItem{aspect-ratio:1/1;border-radius:16px;border:1px solid rgba(255,77,141,.18);display:grid;place-items:center;background:linear-gradient(160deg,#fff,#fff5fa);font-size:clamp(40px,9vw,70px);box-shadow:0 12px 26px rgba(31,41,55,.1)}

    .musicPanel{margin-top:10px;display:grid;gap:10px}
    .musicPanel input[type="file"]{padding:10px;background:#fff;border:1px dashed rgba(255,77,141,.3);border-radius:12px;color:var(--muted)}
    .musicMeta{font-weight:700;color:#8a1747;min-height:24px}

    .game{margin-top:10px;padding:12px;background:#fff;border:1px solid rgba(255,77,141,.2);border-radius:16px}
    .gameTop{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:8px}
    .score{font-weight:900;color:#8a1747;background:#ffe7f1;padding:8px 12px;border-radius:999px}
    .playfield{height:260px;position:relative;overflow:hidden;border-radius:14px;background:radial-gradient(240px 120px at 30% 30%, #ffe5f0, #fff);border:1px solid rgba(0,0,0,.06)}
    .tapHeart{position:absolute;width:30px;height:30px;transform:rotate(45deg);cursor:pointer;animation:fall linear forwards;background:var(--pink)}
    .tapHeart::before,.tapHeart::after{content:"";position:absolute;width:30px;height:30px;background:var(--pink);border-radius:50%}
    .tapHeart::before{left:-15px}.tapHeart::after{top:-15px}
    @keyframes fall{from{transform:translateY(-40px) rotate(45deg);opacity:.98}to{transform:translateY(300px) rotate(45deg);opacity:.2}}
    .tapHeart.hit{animation:none;transform:scale(1.2) rotate(45deg);opacity:0;transition:.18s ease}
    .boom{position:absolute;font-size:18px;animation:boom .45s ease forwards;pointer-events:none}
    @keyframes boom{0%{transform:translateY(0) scale(.7);opacity:1}100%{transform:translateY(-18px) scale(1.15);opacity:0}}
    .broken{position:absolute;font-size:24px;animation:broken .55s ease forwards;pointer-events:none}
    @keyframes broken{0%{transform:translateY(0) scale(.6);opacity:.95}100%{transform:translateY(20px) scale(1.1);opacity:0}}
    .achievements{margin-top:10px;display:grid;gap:8px}
    .badgeLine{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;border-radius:12px;background:#fff5fa;border:1px solid rgba(255,77,141,.2);font-weight:700;color:#8a1747}

    .secretCard{margin-top:14px;padding:16px;border-radius:20px;background:linear-gradient(150deg,#fff,#fff2f8);border:1px solid rgba(255,77,141,.2);box-shadow:var(--shadow)}
    .lockRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .lockRow input{flex:1;min-width:180px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,77,141,.4);font-weight:700}
    .envelopeWrap{margin-top:12px;display:none}
    .envelopeWrap.show{display:block}
    .envelope{position:relative;max-width:520px;margin:auto;background:#fff;border:1px solid rgba(255,77,141,.2);border-radius:16px;overflow:hidden}
    .flap{height:84px;background:linear-gradient(145deg,#ffc1dc,#ff7fb2);clip-path:polygon(0 0,100% 0,50% 100%);transform-origin:top;animation:openFlap .8s ease forwards}
    @keyframes openFlap{to{transform:rotateX(170deg)}}
    .letter{padding:16px 16px 20px;background:#fff;animation:slideUp .7s ease forwards;transform:translateY(40px);opacity:0}
    @keyframes slideUp{to{transform:translateY(0);opacity:1}}

    .modal{position:fixed;inset:0;display:none;z-index:50}
    .modal.show{display:block}
    .backdrop{position:absolute;inset:0;background:rgba(17,24,39,.5);backdrop-filter:blur(6px)}
    .dialog{position:relative;width:min(520px,calc(100vw - 26px));margin:min(12vh,100px) auto 0;background:rgba(255,255,255,.96);border:1px solid rgba(255,77,141,.2);border-radius:22px;box-shadow:0 35px 90px rgba(17,24,39,.25);padding:16px}
    .dialogTop{display:flex;justify-content:space-between;align-items:flex-start}
    .close{width:38px;height:38px;border:0;border-radius:999px;background:#fff;cursor:pointer}
    .content{color:var(--muted);font-weight:650;line-height:1.55;font-size:14px}

    @media (prefers-reduced-motion: reduce){
      *,*::before,*::after{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important;scroll-behavior:auto !important}
    }
  </style>
</head>
<body>
  <div class="hearts" id="bgHearts"></div>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge">üíò</div>
        <div>
          <div>Valentine 14/02</div>
          <div class="tiny">G·ª≠i em y√™u ‚Äî t·ª´ <b>anh</b> ‚ù§Ô∏è</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnSurprise">üéÅ M·ªü qu√†</button>
        <button class="btn ghost" id="btnTheme">üåô Ch·∫ø ƒë·ªô t·ªëi</button>
        <button class="btn ghost" id="btnMusic">üéµ Nh·∫°c</button>
      </div>
    </header>

    <section class="hero">
      <div class="left">
        <div class="kicker">‚ú® M·ªôt chi·∫øc web nh·ªè cho em</div>
        <h1>Ch√∫c em m·ªôt Valentine th·∫≠t ng·ªçt ng√†o üíû</h1>
        <p class="sub">Anh l√†m l·∫°i giao di·ªán xinh h∆°n ƒë·ªÉ em d√πng th·∫•y ‚Äúƒë√£‚Äù h∆°n: ƒë√°ng y√™u, c√≥ nh·∫°c, c√≥ game, c√≥ th∆∞ b√≠ m·∫≠t üíó</p>
        <div class="actions" style="margin-top:12px">
          <button class="btn primary" id="btnGoMusic">üéß Nh·∫°c MP3</button>
          <button class="btn ghost" id="btnGoGame">‚ù§Ô∏è B·∫Øt tim</button>
        </div>
        <div class="chips">
          <span class="chip">#g·∫•u_b√¥ng_d·ªÖ_th∆∞∆°ng</span>
          <span class="chip">#tim_r∆°i_c·ª±c_m∆∞·ª£t</span>
          <span class="chip">#thi·ªáp_m·∫≠t_kh·∫©u</span>
        </div>
      </div>
      <div class="right">
        <div class="bigBear">üß∏</div>
        <div class="heroNote">Tip: b·∫•m ‚ÄúM·ªü qu√†‚Äù ƒë·ªÉ nh·∫≠n b·∫•t ng·ªù nho nh·ªè üòâ</div>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <h2>üß∏ B·ªô s∆∞u t·∫≠p icon g·∫•u b√¥ng</h2>
        <p>ƒê√£ thay ph·∫ßn ·∫£nh g√¢y kh√≥ nh√¨n b·∫±ng c√°c icon g·∫•u b√¥ng cute ƒë·ªÉ b·ªë c·ª•c lu√¥n r√µ r√†ng v√† ƒë·ªìng nh·∫•t.</p>
        <div class="teddyWall">
          <div class="teddyItem">üß∏</div><div class="teddyItem">üêª</div><div class="teddyItem">üß∏</div>
          <div class="teddyItem">üêª‚Äç‚ùÑÔ∏è</div><div class="teddyItem">üß∏</div><div class="teddyItem">üêº</div>
        </div>
      </div>

      <div class="card" id="musicCard">
        <h2>üéµ Nh·∫°c n·ªÅn MP3 (kh√¥ng c·∫ßn s·ª≠a code)</h2>
        <p>Ch·ªçn file mp3 t·ª´ m√°y, l∆∞u l·∫°i ƒë·ªÉ l·∫ßn sau m·ªü trang v·∫´n d√πng ƒë∆∞·ª£c.</p>
        <div class="musicPanel">
          <input id="musicFile" type="file" accept="audio/mpeg,.mp3,audio/mp3" />
          <div class="musicMeta" id="musicMeta">Ch∆∞a c√≥ b√†i nh·∫°c n√†o ƒë∆∞·ª£c l∆∞u.</div>
          <div class="actions">
            <button class="btn primary" id="btnSaveMusic">üíæ L∆∞u nh·∫°c</button>
            <button class="btn ghost" id="btnPlayPause">‚ñ∂Ô∏è Ph√°t</button>
            <button class="btn ghost" id="btnClearMusic">üóëÔ∏è Xo√°</button>
          </div>
        </div>
      </div>

      <div class="card" id="gameCard">
        <h2>‚ù§Ô∏è Mini game: B·∫Øt tim n√¢ng c·∫•p</h2>
        <p>Tr√∫ng tim c√≥ n·ªï sparkle ‚ú®, tr∆∞·ª£t s·∫Ω v·ª° tim üíî. C√≥ danh hi·ªáu v√† m·ªëc ph·∫ßn th∆∞·ªüng.</p>
        <div class="game">
          <div class="gameTop">
            <div class="score" id="score">ƒêi·ªÉm: 0 | Miss: 0</div>
            <div class="actions">
              <button class="btn primary" id="btnPlay">Ch∆°i</button>
              <button class="btn ghost" id="btnStop">D·ª´ng</button>
            </div>
          </div>
          <div class="playfield" id="playfield"></div>
          <div class="achievements">
            <div class="badgeLine"><span>Danh hi·ªáu:</span><span id="titleRank">üå± M·ªõi rung ƒë·ªông</span></div>
            <div class="badgeLine"><span>M·ªëc th∆∞·ªüng:</span><span id="milestone">0/30 tim</span></div>
          </div>
        </div>
      </div>

      <div class="card secretCard">
        <h2>üíå Thi·ªáp b√≠ m·∫≠t m·ªü b·∫±ng m·∫≠t kh·∫©u</h2>
        <p>Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ m·ªü l√° th∆∞ trong thi·ªáp. B·∫°n c√≥ th·ªÉ t·ª± s·ª≠a m·∫≠t kh·∫©u trong code sau.</p>
        <div class="lockRow">
          <input id="letterPass" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u..." />
          <button class="btn primary" id="btnOpenLetter">M·ªü thi·ªáp</button>
        </div>
        <div class="envelopeWrap" id="envelopeWrap">
          <div class="envelope">
            <div class="flap"></div>
            <div class="letter">
              <h3 style="margin:0 0 8px">G·ª≠i em üíó</h3>
              <p style="margin:0;color:#6b7280;font-weight:600;line-height:1.6">C·∫£m ∆°n em ƒë√£ ·ªü ƒë√¢y. M·ªói ng√†y c√≥ em l√† m·ªôt ng√†y d·ªÖ th∆∞∆°ng h∆°n. D√π vui hay m·ªát, anh lu√¥n mu·ªën l√† n∆°i em th·∫•y b√¨nh y√™n.</p>
              <p style="margin:10px 0 0;font-weight:800;color:#8a1747">‚Äî Ng∆∞·ªùi th∆∞∆°ng em.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="modal" id="modal" role="dialog" aria-modal="true">
    <div class="backdrop" id="modalBackdrop"></div>
    <div class="dialog">
      <div class="dialogTop">
        <h3 id="modalTitle" style="margin:4px 0 8px">Th√¥ng b√°o</h3>
        <button class="close" id="modalClose">‚úï</button>
      </div>
      <div class="content" id="modalBody"></div>
      <div class="actions" style="justify-content:flex-end;margin-top:8px">
        <button class="btn primary" id="modalOk">OK</button>
      </div>
    </div>
  </div>

  <audio id="bgm" preload="auto" loop></audio>

  <script>
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalOk = document.getElementById('modalOk');

    function showModal(title, html){
      modalTitle.textContent = title || 'Th√¥ng b√°o';
      modalBody.innerHTML = html || '';
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
    function hideModal(){
      modal.classList.remove('show');
      document.body.style.overflow = '';
    }
    modalOk.onclick = hideModal;
    document.getElementById('modalClose').onclick = hideModal;
    document.getElementById('modalBackdrop').onclick = hideModal;

    (function spawnBgHearts(){
      const wrap = document.getElementById('bgHearts');
      for(let i=0;i<18;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        h.style.left = (Math.random()*100)+'vw';
        h.style.animationDuration = (10 + Math.random()*16)+'s';
        h.style.animationDelay = (Math.random()*-20)+'s';
        const size = 10 + Math.random()*14;
        h.style.width = size+'px';
        h.style.height = size+'px';
        wrap.appendChild(h);
      }
    })();

    const root = document.documentElement;
    const btnTheme = document.getElementById('btnTheme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    function pickTheme(){ return localStorage.getItem('theme') || (systemPrefersDark.matches ? 'dark' : 'light'); }
    function applyTheme(theme){
      root.setAttribute('data-theme', theme);
      btnTheme.textContent = theme === 'dark' ? '‚òÄÔ∏è Ch·∫ø ƒë·ªô s√°ng' : 'üåô Ch·∫ø ƒë·ªô t·ªëi';
    }
    applyTheme(pickTheme());
    btnTheme.onclick = ()=>{ const t = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'; localStorage.setItem('theme', t); applyTheme(t); };

    document.getElementById('btnSurprise').onclick = ()=> showModal('üéÅ B·∫•t ng·ªù', '<b>B√© nh·∫≠n ƒë∆∞·ª£c:</b><ul><li>1 c√°i √¥m th·∫≠t ch·∫∑t</li><li>1 b·ªØa ƒÉn ngon</li><li>1 ng∆∞·ªùi th∆∞∆°ng em r·∫•t nhi·ªÅu ü•∞</li></ul>');

    const bgm = document.getElementById('bgm');
    const musicFile = document.getElementById('musicFile');
    const musicMeta = document.getElementById('musicMeta');
    const btnPlayPause = document.getElementById('btnPlayPause');
    let musicOn = false;
    let loadedDataUrl = '';

    function syncMusicMeta(name){
      musicMeta.textContent = name ? `ƒê√£ l∆∞u: ${name}` : 'Ch∆∞a c√≥ b√†i nh·∫°c n√†o ƒë∆∞·ª£c l∆∞u.';
      btnPlayPause.textContent = musicOn ? '‚è∏Ô∏è T·∫°m d·ª´ng' : '‚ñ∂Ô∏è Ph√°t';
    }

    function restoreSavedMusic(){
      const savedSrc = localStorage.getItem('bgmDataUrl') || '';
      const savedName = localStorage.getItem('bgmName') || '';
      if(savedSrc){
        bgm.src = savedSrc;
        loadedDataUrl = savedSrc;
      }
      syncMusicMeta(savedName);
    }
    restoreSavedMusic();

    document.getElementById('btnSaveMusic').onclick = ()=>{
      const file = musicFile.files?.[0];
      if(!file){ showModal('üéµ Ch∆∞a ch·ªçn file', 'H√£y ch·ªçn file MP3 tr∆∞·ªõc khi l∆∞u nh√©.'); return; }
      if(file.type && !file.type.includes('mpeg') && !file.name.toLowerCase().endsWith('.mp3')){
        showModal('‚ö†Ô∏è Sai ƒë·ªãnh d·∫°ng', 'Vui l√≤ng ch·ªçn file .mp3');
        return;
      }
      const reader = new FileReader();
      reader.onload = ()=>{
        loadedDataUrl = String(reader.result || '');
        bgm.src = loadedDataUrl;
        localStorage.setItem('bgmDataUrl', loadedDataUrl);
        localStorage.setItem('bgmName', file.name);
        syncMusicMeta(file.name);
        showModal('‚úÖ ƒê√£ l∆∞u', `ƒê√£ l∆∞u b√†i <b>${file.name}</b>. L·∫ßn sau m·ªü trang v·∫´n d√πng ƒë∆∞·ª£c.`);
      };
      reader.readAsDataURL(file);
    };

    btnPlayPause.onclick = async ()=>{
      if(!bgm.src && !loadedDataUrl){ showModal('üéµ Ch∆∞a c√≥ nh·∫°c', 'H√£y ch·ªçn v√† l∆∞u m·ªôt file MP3 tr∆∞·ªõc.'); return; }
      try{
        if(!musicOn){ await bgm.play(); musicOn = true; }
        else { bgm.pause(); musicOn = false; }
        syncMusicMeta(localStorage.getItem('bgmName') || 'B√†i nh·∫°c t·∫°m th·ªùi');
      }catch{
        showModal('‚ö†Ô∏è Kh√¥ng ph√°t ƒë∆∞·ª£c', 'Tr√¨nh duy·ªát ƒëang ch·∫∑n √¢m thanh, h√£y b·∫•m l·∫°i l·∫ßn n·ªØa nh√©.');
      }
    };

    document.getElementById('btnClearMusic').onclick = ()=>{
      bgm.pause();
      musicOn = false;
      bgm.src = '';
      loadedDataUrl = '';
      localStorage.removeItem('bgmDataUrl');
      localStorage.removeItem('bgmName');
      musicFile.value = '';
      syncMusicMeta('');
    };

    document.getElementById('btnMusic').onclick = ()=> document.getElementById('musicCard').scrollIntoView({behavior:'smooth'});
    document.getElementById('btnGoMusic').onclick = ()=> document.getElementById('musicCard').scrollIntoView({behavior:'smooth'});
    document.getElementById('btnGoGame').onclick = ()=> document.getElementById('gameCard').scrollIntoView({behavior:'smooth'});

    const playfield = document.getElementById('playfield');
    const scoreEl = document.getElementById('score');
    const titleRank = document.getElementById('titleRank');
    const milestoneEl = document.getElementById('milestone');
    let playing = false, score = 0, miss = 0, spawner = null;

    function rankByScore(s){
      if(s >= 30) return 'üëë Tr√πm b·∫Øt tim';
      if(s >= 20) return 'üíò Cao th·ªß si t√¨nh';
      if(s >= 10) return 'üå∏ B·∫Øt tim c·ª´ kh√¥i';
      return 'üå± M·ªõi rung ƒë·ªông';
    }

    function updateBoard(){
      scoreEl.textContent = `ƒêi·ªÉm: ${score} | Miss: ${miss}`;
      titleRank.textContent = rankByScore(score);
      milestoneEl.textContent = `${score}/30 tim`;
      if(score === 10) showModal('üèÖ M·ªëc 10 tim', 'Th∆∞·ªüng: 1 c√¢u khen si√™u ng·ªçt t·ª´ anh.');
      if(score === 20) showModal('üèÖ M·ªëc 20 tim', 'Th∆∞·ªüng: 1 l·ªùi h·ª©a ƒëi ƒÉn m√≥n em th√≠ch.');
      if(score === 30) showModal('üîì M·ªëc 30 tim', 'B·∫°n ƒë√£ m·ªü m·ªëc b√≠ m·∫≠t c·ªßa ng∆∞·ªùi con trai. (B·∫°n s·∫Ω t·ª± ch·ªânh n·ªôi dung b√≠ m·∫≠t sau)');
    }

    function spawnBoom(x, y){
      for(let i=0;i<5;i++){
        const b = document.createElement('div');
        b.className = 'boom';
        b.textContent = ['‚ú®','üíñ','‚≠ê'][Math.floor(Math.random()*3)];
        b.style.left = `${x + (Math.random()*24 - 12)}px`;
        b.style.top = `${y + (Math.random()*24 - 12)}px`;
        playfield.appendChild(b);
        b.addEventListener('animationend', ()=> b.remove());
      }
    }

    function spawnBroken(x, y){
      const e = document.createElement('div');
      e.className = 'broken';
      e.textContent = 'üíî';
      e.style.left = `${x}px`;
      e.style.top = `${y}px`;
      playfield.appendChild(e);
      e.addEventListener('animationend', ()=> e.remove());
    }

    function spawnHeart(){
      const h = document.createElement('div');
      h.className = 'tapHeart';
      const x = Math.random() * (playfield.clientWidth - 30);
      const dur = 1.25 + Math.random()*1.25;
      h.style.left = x + 'px';
      h.style.animationDuration = dur + 's';
      h.dataset.caught = '0';

      h.addEventListener('click', ()=>{
        if(h.dataset.caught === '1') return;
        h.dataset.caught = '1';
        score++;
        h.classList.add('hit');
        spawnBoom(x, h.offsetTop);
        updateBoard();
        setTimeout(()=>h.remove(), 180);
      });

      h.addEventListener('animationend', ()=>{
        if(h.dataset.caught === '0'){
          miss++;
          spawnBroken(x, playfield.clientHeight - 35);
          updateBoard();
        }
        h.remove();
      });
      playfield.appendChild(h);
    }

    function startGame(){
      if(playing) return;
      playing = true;
      score = 0;
      miss = 0;
      playfield.innerHTML = '';
      updateBoard();
      spawner = setInterval(spawnHeart, 380);
      spawnHeart();
    }

    function stopGame(){
      if(!playing){ showModal('‚ÑπÔ∏è Ch∆∞a b·∫Øt ƒë·∫ßu', 'B·∫•m Ch∆°i tr∆∞·ªõc r·ªìi m√¨nh b·∫Øt tim nha.'); return; }
      playing = false;
      clearInterval(spawner);
      spawner = null;
      playfield.innerHTML = '';
      showModal('‚úÖ K·∫øt th√∫c game', `T·ªïng k·∫øt: <b>${score}</b> tim b·∫Øt ƒë∆∞·ª£c, <b>${miss}</b> tim v·ª°.`);
    }

    document.getElementById('btnPlay').onclick = startGame;
    document.getElementById('btnStop').onclick = stopGame;

    const SECRET_PASSWORD = 'yeuem';
    document.getElementById('btnOpenLetter').onclick = ()=>{
      const value = document.getElementById('letterPass').value.trim();
      if(!value){ showModal('üîê Thi·∫øu m·∫≠t kh·∫©u', 'Nh·∫≠p m·∫≠t kh·∫©u tr∆∞·ªõc khi m·ªü thi·ªáp nh√©.'); return; }
      if(value !== SECRET_PASSWORD){ showModal('‚ùå Sai m·∫≠t kh·∫©u', 'M·∫≠t kh·∫©u ch∆∞a ƒë√∫ng, th·ª≠ l·∫°i nha.'); return; }
      document.getElementById('envelopeWrap').classList.add('show');
      showModal('üíå M·ªü thi·ªáp th√†nh c√¥ng', 'L√° th∆∞ ƒë√£ m·ªü ra t·ª´ trong t·∫•m thi·ªáp r·ªìi ƒë√≥!');
    };
  </script>
</body>
</html>
